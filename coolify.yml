app:
  name: rasa-chatbot
  services:
    rasa:
      port: 5005
      healthcheck:
        path: /status
        port: 5005
      environment:
        - RASA_ENV=${RASA_ENV:-production}
        - PYTHONUNBUFFERED=1
        - RASA_TELEMETRY_ENABLED=false
        - ACTION_SERVER_URL=${ACTION_SERVER_URL}
      volumes:
        - type: bind
          source: ./data
          target: /app/data
          read_only: true
        - type: bind
          source: ./models
          target: /app/models
        - type: bind
          source: ./config.yml
          target: /app/config.yml
          read_only: true
        - type: bind
          source: ./domain.yml
          target: /app/domain.yml
          read_only: true
        - type: bind
          source: ./credentials.yml
          target: /app/credentials.yml
          read_only: true
        - type: bind
          source: ./endpoints.yml
          target: /app/endpoints.yml
          read_only: true
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G

    actions:
      port: 5055
      healthcheck:
        path: /health
        port: 5055
      environment:
        - RASA_ENV=production
        - PYTHONUNBUFFERED=1
      volumes:
        - type: bind
          source: ./actions
          target: /app/actions
          read_only: true
        - type: bind
          source: ./models
          target: /app/models
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  environment:
    - name: OPENAI_API_KEY
      required: true
      secret: true
