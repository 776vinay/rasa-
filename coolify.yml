app:
  name: rasa-chatbot
  services:
    rasa:
      port: 5005
      healthcheck:
        path: /status
        port: 5005
      environment:
        - RASA_ENV=production
        - PYTHONUNBUFFERED=1
        - RASA_TELEMETRY_ENABLED=false
      volumes:
        - ./data:/app/data:ro
        - ./models:/app/models
        - ./config.yml:/app/config.yml:ro
        - ./domain.yml:/app/domain.yml:ro
        - ./credentials.yml:/app/credentials.yml:ro
        - ./endpoints.yml:/app/endpoints.yml:ro
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G

    actions:
      port: 5055
      healthcheck:
        path: /health
        port: 5055
      environment:
        - RASA_ENV=production
        - PYTHONUNBUFFERED=1
      volumes:
        - ./actions:/app/actions:ro
        - ./models:/app/models
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  environment:
    - name: OPENAI_API_KEY
      required: true
      secret: true
